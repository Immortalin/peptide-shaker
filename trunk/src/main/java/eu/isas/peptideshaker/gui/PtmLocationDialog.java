/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */

/*
 * PtmLocationDialog.java
 *
 * Created on Sep 28, 2011, 3:15:57 PM
 */
package eu.isas.peptideshaker.gui;

import com.compomics.util.experiment.biology.PTM;
import com.compomics.util.experiment.biology.PTMFactory;
import com.compomics.util.experiment.biology.Peptide;
import com.compomics.util.experiment.identification.Identification;
import com.compomics.util.experiment.identification.matches.ModificationMatch;
import com.compomics.util.experiment.identification.matches.PeptideMatch;
import eu.isas.peptideshaker.myparameters.PSParameter;
import eu.isas.peptideshaker.myparameters.PSPtmScores;
import eu.isas.peptideshaker.scoring.PtmScoring;
import java.util.ArrayList;
import javax.swing.DefaultComboBoxModel;
import javax.swing.JOptionPane;
import javax.swing.table.DefaultTableModel;

/**
 *
 * @author vaudel
 */
public class PtmLocationDialog extends javax.swing.JDialog {

    /**
     * The PeptideShakerGUI instance
     */
    private PeptideShakerGUI peptideShakerGUI;
    /**
     * The compomics PTM factory
     */
    private PTMFactory ptmFactory = PTMFactory.getInstance();
    /**
     * The identification
     */
    private Identification identification;
    /**
     * the peptide match
     */
    private PeptideMatch peptideMatch = null;
    /**
     * the original location of the modification
     */
    private String originalLocation = "";

    /** Creates new form PtmLocationDialog */
    public PtmLocationDialog(PeptideShakerGUI peptideShakerGUI, String peptideKey, String selectedPTM, int psmSelected) {
        super(peptideShakerGUI, true);

        this.peptideShakerGUI = peptideShakerGUI;
        this.identification = peptideShakerGUI.getIdentification();
        try {
            this.peptideMatch = identification.getPeptideMatch(peptideKey);
        } catch (Exception e) {
            peptideShakerGUI.catchException(e);
            return;
        }

        initComponents();

        sequenceTxt.setText(peptideMatch.getTheoreticPeptide().getModifiedSequenceAsHtml(
                peptideShakerGUI.getSearchParameters().getModificationProfile().getPtmColors(), true));

        if (selectedPTM != null) {
            ptmCmb.setSelectedItem(selectedPTM);
            ptmCmbMouseReleased(null);
        }

        psmTable.setRowSelectionInterval(psmSelected, psmSelected);
        psmSelectionChanged();

        setVisible(true);
    }

    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jPanel1 = new javax.swing.JPanel();
        jLabel1 = new javax.swing.JLabel();
        sequenceTxt = new javax.swing.JTextField();
        ptmCmb = new javax.swing.JComboBox();
        peptideConfidence = new javax.swing.JTextField();
        jPanel2 = new javax.swing.JPanel();
        jScrollPane1 = new javax.swing.JScrollPane();
        psmTable = new javax.swing.JTable();
        jPanel3 = new javax.swing.JPanel();
        jSplitPane1 = new javax.swing.JSplitPane();
        jPanel4 = new javax.swing.JPanel();
        jLabel2 = new javax.swing.JLabel();
        jLabel3 = new javax.swing.JLabel();
        possibleLocationsTxt = new javax.swing.JTextField();
        psmConfidence = new javax.swing.JComboBox();
        jPanel5 = new javax.swing.JPanel();
        jLabel5 = new javax.swing.JLabel();
        ptmLocationTxt = new javax.swing.JTextField();
        spectrumA = new javax.swing.JPanel();
        jLabel6 = new javax.swing.JLabel();
        newPtmTxt = new javax.swing.JTextField();
        applyButton = new javax.swing.JButton();
        spectrumB = new javax.swing.JPanel();
        cancelApplyButton = new javax.swing.JButton();
        jButton3 = new javax.swing.JButton();

        setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);

        jPanel1.setBorder(javax.swing.BorderFactory.createTitledBorder("Peptide details"));

        jLabel1.setText("Sequence:");

        sequenceTxt.setEditable(false);

        ptmCmb.setModel(new DefaultComboBoxModel(getPossibleModifications()));
        ptmCmb.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseReleased(java.awt.event.MouseEvent evt) {
                ptmCmbMouseReleased(evt);
            }
        });

        peptideConfidence.setEditable(false);

        javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jLabel1)
                .addGap(18, 18, 18)
                .addComponent(sequenceTxt, javax.swing.GroupLayout.PREFERRED_SIZE, 304, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(ptmCmb, 0, 107, Short.MAX_VALUE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(peptideConfidence, javax.swing.GroupLayout.PREFERRED_SIZE, 162, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap())
        );
        jPanel1Layout.setVerticalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel1)
                    .addComponent(sequenceTxt, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(ptmCmb, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(peptideConfidence, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        jPanel2.setBorder(javax.swing.BorderFactory.createTitledBorder("PSMs"));

        psmTable.setModel(new PsmsTable());
        jScrollPane1.setViewportView(psmTable);

        javax.swing.GroupLayout jPanel2Layout = new javax.swing.GroupLayout(jPanel2);
        jPanel2.setLayout(jPanel2Layout);
        jPanel2Layout.setHorizontalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel2Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jScrollPane1, javax.swing.GroupLayout.DEFAULT_SIZE, 654, Short.MAX_VALUE)
                .addContainerGap())
        );
        jPanel2Layout.setVerticalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel2Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 173, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        jPanel3.setBorder(javax.swing.BorderFactory.createTitledBorder("Selected PSM PTM details"));

        jSplitPane1.setDividerLocation(200);

        jLabel2.setText("PTM scoring:");

        jLabel3.setText("Possible locations:");

        possibleLocationsTxt.setEditable(false);

        psmConfidence.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "not found", "random assignment", "doubtful assignment", "confident assignment", "very confident assignment" }));
        psmConfidence.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseReleased(java.awt.event.MouseEvent evt) {
                psmConfidenceMouseReleased(evt);
            }
        });
        psmConfidence.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                psmConfidenceActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel4Layout = new javax.swing.GroupLayout(jPanel4);
        jPanel4.setLayout(jPanel4Layout);
        jPanel4Layout.setHorizontalGroup(
            jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel4Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(psmConfidence, 0, 179, Short.MAX_VALUE)
                    .addGroup(jPanel4Layout.createSequentialGroup()
                        .addComponent(jLabel3)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(possibleLocationsTxt, javax.swing.GroupLayout.DEFAULT_SIZE, 88, Short.MAX_VALUE))
                    .addComponent(jLabel2))
                .addContainerGap())
        );
        jPanel4Layout.setVerticalGroup(
            jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel4Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(psmConfidence, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(12, 12, 12)
                .addGroup(jPanel4Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel3)
                    .addComponent(possibleLocationsTxt, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(18, 18, 18)
                .addComponent(jLabel2)
                .addContainerGap(332, Short.MAX_VALUE))
        );

        jSplitPane1.setLeftComponent(jPanel4);

        jLabel5.setText("PTM location:");

        ptmLocationTxt.setEditable(false);

        javax.swing.GroupLayout spectrumALayout = new javax.swing.GroupLayout(spectrumA);
        spectrumA.setLayout(spectrumALayout);
        spectrumALayout.setHorizontalGroup(
            spectrumALayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 448, Short.MAX_VALUE)
        );
        spectrumALayout.setVerticalGroup(
            spectrumALayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 148, Short.MAX_VALUE)
        );

        jLabel6.setText("New PTM location:");

        applyButton.setText("Apply");
        applyButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                applyButtonActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout spectrumBLayout = new javax.swing.GroupLayout(spectrumB);
        spectrumB.setLayout(spectrumBLayout);
        spectrumBLayout.setHorizontalGroup(
            spectrumBLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 448, Short.MAX_VALUE)
        );
        spectrumBLayout.setVerticalGroup(
            spectrumBLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 184, Short.MAX_VALUE)
        );

        cancelApplyButton.setText("Cancel");
        cancelApplyButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cancelApplyButtonActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel5Layout = new javax.swing.GroupLayout(jPanel5);
        jPanel5.setLayout(jPanel5Layout);
        jPanel5Layout.setHorizontalGroup(
            jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel5Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(spectrumB, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(spectrumA, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addGroup(jPanel5Layout.createSequentialGroup()
                        .addComponent(jLabel5)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(ptmLocationTxt, javax.swing.GroupLayout.DEFAULT_SIZE, 380, Short.MAX_VALUE))
                    .addGroup(jPanel5Layout.createSequentialGroup()
                        .addComponent(jLabel6)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(newPtmTxt, javax.swing.GroupLayout.DEFAULT_SIZE, 210, Short.MAX_VALUE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(applyButton, javax.swing.GroupLayout.PREFERRED_SIZE, 69, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(cancelApplyButton)))
                .addContainerGap())
        );
        jPanel5Layout.setVerticalGroup(
            jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel5Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel5)
                    .addComponent(ptmLocationTxt, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(spectrumA, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(18, 18, 18)
                .addGroup(jPanel5Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel6)
                    .addComponent(newPtmTxt, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(cancelApplyButton)
                    .addComponent(applyButton))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(spectrumB, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addContainerGap())
        );

        jSplitPane1.setRightComponent(jPanel5);

        javax.swing.GroupLayout jPanel3Layout = new javax.swing.GroupLayout(jPanel3);
        jPanel3.setLayout(jPanel3Layout);
        jPanel3Layout.setHorizontalGroup(
            jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jSplitPane1, javax.swing.GroupLayout.DEFAULT_SIZE, 674, Short.MAX_VALUE)
        );
        jPanel3Layout.setVerticalGroup(
            jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jSplitPane1, javax.swing.GroupLayout.DEFAULT_SIZE, 429, Short.MAX_VALUE)
        );

        jButton3.setText("Exit");
        jButton3.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton3ActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(jPanel3, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(jPanel1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(jPanel2, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(jButton3))
                .addContainerGap())
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jPanel1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jPanel2, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jPanel3, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jButton3)
                .addContainerGap())
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void ptmCmbMouseReleased(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_ptmCmbMouseReleased
        PSPtmScores ptmScores = new PSPtmScores();
            ptmScores = (PSPtmScores) peptideMatch.getUrParam(ptmScores);
            PtmScoring ptmScoring = ptmScores.getPtmScoring(getSelectedModification());
            if (ptmScoring.getPtmSiteConfidence() == PtmScoring.NOT_FOUND) {
                peptideConfidence.setText("Not found");
            } else if (ptmScoring.getPtmSiteConfidence() == PtmScoring.RANDOM) {
                peptideConfidence.setText("Random assignment");
            } else if (ptmScoring.getPtmSiteConfidence() == PtmScoring.DOUBTFUL) {
                peptideConfidence.setText("Doubtful assignment");
            } else if (ptmScoring.getPtmSiteConfidence() == PtmScoring.CONFIDENT) {
                peptideConfidence.setText("Confident assignment");
            } else if (ptmScoring.getPtmSiteConfidence() == PtmScoring.VERY_CONFIDENT) {
                peptideConfidence.setText("Very confident assignment");
            }
        updatePsmTable();
    }//GEN-LAST:event_ptmCmbMouseReleased

    private void psmConfidenceMouseReleased(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_psmConfidenceMouseReleased
        
    }//GEN-LAST:event_psmConfidenceMouseReleased

    private void applyButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_applyButtonActionPerformed
        try {
            ArrayList<Integer> newLocations = parseLocationList(newPtmTxt.getText().trim());
            if (newLocations.size() != parseLocationList(originalLocation).size()) {
                throw new IllegalArgumentException("Not correct number of locations");
            }
            ptmLocationTxt.setText(newPtmTxt.getText().trim());
            String key = PtmScoring.getKey(newLocations);
            String spectrumKey = peptideMatch.getSpectrumMatches().get(psmTable.getSelectedRow());
            PSPtmScores ptmScores = new PSPtmScores();
            ptmScores = (PSPtmScores) identification.getSpectrumMatch(spectrumKey).getUrParam(ptmScores);
            PtmScoring ptmScoring = ptmScores.getPtmScoring(getSelectedModification());
            ptmScoring.setPtmSite(key, ptmScoring.getPtmSiteConfidence());
            updatePsmTable();
        } catch (IllegalArgumentException e) {
            JOptionPane.showMessageDialog(this,
                    "An error occured while reading the new modification locations"
                    + e.getLocalizedMessage() + "\n",
                    "Error",
                    JOptionPane.ERROR_MESSAGE);
        } catch (Exception e) {
            peptideShakerGUI.catchException(e);
        }
    }//GEN-LAST:event_applyButtonActionPerformed

    private void cancelApplyButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cancelApplyButtonActionPerformed
        newPtmTxt.setText(originalLocation);
        applyButtonActionPerformed(null);
    }//GEN-LAST:event_cancelApplyButtonActionPerformed

    private void jButton3ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton3ActionPerformed
        dispose();
    }//GEN-LAST:event_jButton3ActionPerformed

    private void psmConfidenceActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_psmConfidenceActionPerformed
        try {
            String spectrumKey = peptideMatch.getSpectrumMatches().get(psmTable.getSelectedRow());
            PSPtmScores ptmScores = new PSPtmScores();
            ptmScores = (PSPtmScores) identification.getSpectrumMatch(spectrumKey).getUrParam(ptmScores);
            PtmScoring ptmScoring = ptmScores.getPtmScoring(getSelectedModification());
            ptmScoring.setPtmSite(ptmScoring.getPtmLocation(), psmConfidence.getSelectedIndex());
            updatePsmTable();
        } catch (Exception e) {
            peptideShakerGUI.catchException(e);
        }
    }//GEN-LAST:event_psmConfidenceActionPerformed

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton applyButton;
    private javax.swing.JButton cancelApplyButton;
    private javax.swing.JButton jButton3;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JPanel jPanel3;
    private javax.swing.JPanel jPanel4;
    private javax.swing.JPanel jPanel5;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JSplitPane jSplitPane1;
    private javax.swing.JTextField newPtmTxt;
    private javax.swing.JTextField peptideConfidence;
    private javax.swing.JTextField possibleLocationsTxt;
    private javax.swing.JComboBox psmConfidence;
    private javax.swing.JTable psmTable;
    private javax.swing.JComboBox ptmCmb;
    private javax.swing.JTextField ptmLocationTxt;
    private javax.swing.JTextField sequenceTxt;
    private javax.swing.JPanel spectrumA;
    private javax.swing.JPanel spectrumB;
    // End of variables declaration//GEN-END:variables

    private Object[] getPossibleModifications() {
        ArrayList<String> result = new ArrayList<String>();
        for (ModificationMatch modMatch : peptideMatch.getTheoreticPeptide().getModificationMatches()) {
            if (!result.contains(modMatch.getTheoreticPtm())) {
                result.add(modMatch.getTheoreticPtm());
            }
        }
        return result.toArray();
    }

    private String getSelectedModification() {
        return (String) ptmCmb.getSelectedItem();
    }

    private void psmSelectionChanged() {
        try {
            String spectrumKey = peptideMatch.getSpectrumMatches().get(psmTable.getSelectedRow());
            PSPtmScores ptmScores = new PSPtmScores();
            ptmScores = (PSPtmScores) identification.getSpectrumMatch(spectrumKey).getUrParam(ptmScores);
            PtmScoring ptmScoring = ptmScores.getPtmScoring(getSelectedModification());
            psmConfidence.setSelectedIndex(ptmScoring.getPtmSiteConfidence());
            PTM selectedPtm = ptmFactory.getPTM(getSelectedModification());
            ArrayList<Integer> potentialModificationSites = Peptide.getPotentialModificationSites(peptideMatch.getTheoreticPeptide().getSequence(), selectedPtm);
            possibleLocationsTxt.setText(getlocationListAsString(potentialModificationSites));
            ptmLocationTxt.setText(getlocationListAsString(PtmScoring.getLocations(ptmScoring.getPtmLocation())));
            newPtmTxt.setText(ptmLocationTxt.getText());
            originalLocation = ptmLocationTxt.getText();
            cancelApplyButton.setEnabled(false);
        } catch (Exception e) {
            peptideShakerGUI.catchException(e);
        }
    }

    private void updatePsmTable() {
        psmTable.revalidate();
        psmTable.repaint();
    }

    private String getlocationListAsString(ArrayList<Integer> locations) {
        String result = "";
        boolean firstLine = true;
        for (int location : locations) {
            if (!firstLine) {
                result += ", ";
            } else {
                firstLine = false;
            }
            result += location;
        }
        return result;
    }

    private ArrayList<Integer> parseLocationList(String modificationPositons) throws IllegalArgumentException {
        ArrayList<Integer> result = new ArrayList<Integer>();
        String[] positionsAsString = modificationPositons.split(", ");
        for (String position : positionsAsString) {
            try {
                result.add(new Integer(position));
            } catch (Exception e) {
                throw new IllegalArgumentException("Could not parse " + position + "as integer.");
            }
        }
        return result;
    }

    /**
     * Table model for the selected peptide PSMs table
     */
    private class PsmsTable extends DefaultTableModel {

        @Override
        public int getRowCount() {
            return peptideMatch.getSpectrumCount();
        }

        @Override
        public int getColumnCount() {
            return 8;
        }

        @Override
        public String getColumnName(int column) {
            switch (column) {
                case 0:
                    return " ";
                case 1:
                    return "Sequence";
                case 2:
                    return "PTM confidence";
                case 3:
                    return "Charge";
                case 4:
                    return "Precursor error";
                case 5:
                    return "Score";
                case 6:
                    return "Confidence";
                case 7:
                    return "   ";
                default:
                    return "";
            }
        }

        @Override
        public Object getValueAt(int row, int column) {
            try {
                String spectrumKey;
                PSParameter psParameter;
                switch (column) {
                    case 0:
                        return row + 1;
                    case 1:
                        spectrumKey = peptideMatch.getSpectrumMatches().get(row);
                        return identification.getSpectrumMatch(spectrumKey).getBestAssumption().getPeptide().getModifiedSequenceAsHtml(
                                peptideShakerGUI.getSearchParameters().getModificationProfile().getPtmColors(), true);
                    case 2:
                        spectrumKey = peptideMatch.getSpectrumMatches().get(row);
                        PSPtmScores ptmScores = new PSPtmScores();
                        ptmScores = (PSPtmScores) identification.getSpectrumMatch(spectrumKey).getUrParam(ptmScores);
                        if (ptmScores != null && ptmScores.getPtmScoring(getSelectedModification()) != null) {
                            return ptmScores.getPtmScoring(getSelectedModification()).getPtmSiteConfidence();
                        } else {
                            return PtmScoring.NOT_FOUND;
                        }
                    case 3:
                        spectrumKey = peptideMatch.getSpectrumMatches().get(row);
                        return peptideShakerGUI.getPrecursor(spectrumKey).getCharge().value;
                    case 4:
                        spectrumKey = peptideMatch.getSpectrumMatches().get(row);
                        return identification.getSpectrumMatch(spectrumKey).getBestAssumption().getDeltaMass();
                    case 5:
                        spectrumKey = peptideMatch.getSpectrumMatches().get(row);
                        psParameter = new PSParameter();
                        psParameter = (PSParameter) identification.getMatchParameter(spectrumKey, psParameter);
                        return psParameter.getPsmScore();
                    case 6:
                        spectrumKey = peptideMatch.getSpectrumMatches().get(row);
                        psParameter = new PSParameter();
                        psParameter = (PSParameter) identification.getMatchParameter(spectrumKey, psParameter);
                        return psParameter.getPsmConfidence();
                    case 7:
                        spectrumKey = peptideMatch.getSpectrumMatches().get(row);
                        psParameter = new PSParameter();
                        psParameter = (PSParameter) identification.getMatchParameter(spectrumKey, psParameter);
                        return psParameter.isValidated();
                    default:
                        return "";
                }
            } catch (Exception e) {
                peptideShakerGUI.catchException(e);
                return "";
            }
        }

        @Override
        public Class getColumnClass(int columnIndex) {
            for (int i = 0; i < getRowCount(); i++) {
                if (getValueAt(i, columnIndex) != null) {
                    return getValueAt(i, columnIndex).getClass();
                }
            }
            return (new Double(0.0)).getClass();
        }

        @Override
        public boolean isCellEditable(int rowIndex, int columnIndex) {
            return false;
        }
    }
}
